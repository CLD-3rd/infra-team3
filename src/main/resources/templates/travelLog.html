<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Travel Log</title>
    <link rel="icon" type="image/png" th:href="@{/images/globetrek_logo.png}">
    <link rel="stylesheet" th:href="@{/css/TLstyle.css}">
    <script th:src="@{/js/TLscript.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Left -->
        <div class="left">
            <!-- Main -->
            <div class="photo-section">
                <img th:src="${mainPhoto.picUrl}" th:alt="${mainPhoto.title}" alt="Main Photo">
            </div>

            <!-- Related -->
            <div class="related-section">
                <div class="related-title">Ïó∞Í¥ÄÎêú ÏÇ¨ÏßÑ</div>
                <div class="related-photos">
                    <div th:each="relatedPhoto : ${relatedPhotos}">
                        <a th:href="@{/gallery/{id}(id=${relatedPhoto.logId})}">
                            <img th:src="${relatedPhoto.picUrl}" alt="Related Photo">
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right -->
        <div class="right">
            <div class="info-section">
                <!-- Info -->
                <h2 th:text="${mainPhoto.title}">TITLE</h2>
                <input type="hidden" id="currentUserId" th:value="${currentUserId}" />
                <div class="meta">üìÖ <span th:text="${#temporals.format(mainPhoto.updatedAt, 'MMMM dd, yyyy')}">May 19,
                        2025</span></div>

                <!-- Like, wish -->
                <div class="likes">
                    <span class="like-count" th:text="'‚ù§Ô∏è ' + ${mainPhoto.likeCount} + ' Likes'">‚ù§Ô∏è 1 Likes</span>
                    <!-- Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎßå Ï¢ãÏïÑÏöî Î≤ÑÌäº ÌëúÏãú -->
                    <button th:if="${currentUserId != null}" type="button" class="like-btn" th:data-log-id="${mainPhoto.logId}" th:classappend="${mainPhoto.liked} ? 'liked' : ''" th:text="${mainPhoto.liked} ? 'üíîUnlike' : '‚ù§Ô∏èLike'">‚ù§Ô∏èLike</button>
                    <!-- Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎßå ÏúÑÏãúÎ¶¨Ïä§Ìä∏ Î≤ÑÌäº ÌëúÏãú -->
                    <button th:if="${currentUserId != null}" id="wishlistToggleBtn" type="button" th:text="${mainPhoto.isWished} ? '‚úîÔ∏è Wished' : '‚ô° Wish'">‚ô° Wish</button>
                </div>

                <!-- WL Popover -->
                <div class="wishlist-popover-container" th:if="${currentUserId != null}">
                    <div id="wishlistPopover" class="wishlist-popover-content">
                        <h4>Wishlist Îì±Î°ù</h4>
                        <div class="wishlist-form">
                            <form th:action="@{/users/current/wishlists}" method="post" id="wishlistForm">
                                <input type="hidden" name="country_id" th:value="${mainPhoto.countryId}"/>
                                <label>
                                    Ïó¨Ìñâ ÏãúÏûë:
                                    <input type="date" name="travel_date"/>
                                </label>
                                <label>
                                    Ïó¨Ìñâ Ï¢ÖÎ£å:
                                    <input type="date" name="end_date"/>
                                </label>
                                <button type="submit">Îì±Î°ù</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Country info -->
                <div class="country-info">
                    üìç <a th:href="@{/countries/{countryId}/gallery(countryId=${mainPhoto.countryId})}" class="country-link">
                        <span th:text="${mainPhoto.countryName}">South Korea</span>
                    </a>
                </div>

                <!-- Comments -->
                <div class="comment-box" th:data-log-id="${mainPhoto.logId}">
                    <!-- ÎåìÍ∏ÄÏù¥ ÏóÜÏùÑ Îïå ÌëúÏãúÌï† Î©îÏãúÏßÄ -->
                    <div th:if="${comments.empty}" class="no-comments">
                        <p>Îì±Î°ùÎêú ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                    <!-- ÎåìÍ∏Ä Î™©Î°ù -->
                    <div class="comment" th:each="comment : ${comments}" th:attr="data-comment-id=${comment.commentId}">
                        <div class="comment-header">
                            <div class="comment-info">
                                <strong th:text="${comment.userNickname}">ÏûëÏÑ±Ïûê</strong>
                                <span class="comment-date" th:text="${#temporals.format(comment.updatedAt, 'yyyy.MM.dd HH:mm')}">2024.03.21 14:30</span>
                            </div>
                            <div class="comment-actions">
                                <div class="default-actions" th:if="${comment.userId == currentUserId}">
                                    <button class="edit-btn">ÏàòÏ†ï</button>
                                    <button class="delete-btn">ÏÇ≠Ï†ú</button>
                                </div>
                                <div class="edit-actions" style="display: none;">
                                    <button class="save-btn">Ï†ÄÏû•</button>
                                    <button class="cancel-btn">Ï∑®ÏÜå</button>
                                </div>
                            </div>
                        </div>
                        <div class="comment-body">
                            <div class="comment-content" th:text="${comment.content}"></div>
                            <div class="edit-form" style="display: none;">
                                <textarea class="edit-input" th:text="${comment.content}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comment -->
                <div class="comment-section" th:if="${currentUserId != null}">
                    <form id="commentForm" class="comment-form">
                        <div class="comment-input-row">
                            <textarea name="content" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                            <button type="submit">ÎåìÍ∏Ä Îì±Î°ù</button>
                        </div>
                    </form>
                </div>
                <div class="comment-section" th:if="${currentUserId == null}">
                    <p class="login-message">ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±ÌïòÎ†§Î©¥ <a href="/auth/login">Î°úÍ∑∏Ïù∏</a>Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox-overlay" id="lightbox">
        <img src="" alt="Expanded Photo">
    </div>
</body>
</html>