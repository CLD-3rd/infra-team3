<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Travel Log</title>

    <link rel="stylesheet" th:href="@{/css/TLstyle.css}">
    <script th:src="@{/js/TLscript.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container">
    <div class="photo-section">
        <img th:src="${mainPhoto.picUrl}" th:alt="${mainPhoto.title}" alt="Main Photo">
    </div>

    <div class="info-section">
        <h2 th:text="${mainPhoto.title}">TITLE</h2>
        <input type="hidden" id="currentUserId" th:value="${currentUserId}" />
        <div class="meta">üìÖ <span th:text="${#temporals.format(mainPhoto.createdAt, 'MMMM dd, yyyy')}">May 19,
                    2025</span></div>
        <!-- Like toggle -->
        <div class="likes">
            <span class="like-count" th:text="'‚ù§Ô∏è ' + ${mainPhoto.likeCount} + ' Likes'">‚ù§Ô∏è 1 Likes</span>
            <button type="button" class="like-btn" th:data-log-id="${mainPhoto.logId}" th:classappend="${mainPhoto.liked} ? 'liked' : ''" th:text="${mainPhoto.liked} ? 'üíî Unlike' : '‚ù§Ô∏è Like'">‚ù§Ô∏è</button>
        </div>

        <!-- Wishlist popover -->
        <div class="wishlist-popover-container" style="position: relative; margin-top:10px;">
            <button id="wishlistToggleBtn" type="button" th:text="${mainPhoto.isWished} ? 'Wished' : 'Wish'">Wish</button>
            <div id="wishlistPopover" class="wishlist-popover-content"
                 style="display:none; position:absolute; top:100%; left:0; background:white; border:1px solid #cccccc; border-radius:5px; box-shadow:0 2px 8px rgba(0,0,0,0.2); padding:15px; z-index:100;">
                <h4>Wishlist Îì±Î°ù</h4>
                <div class="wishlist-form">
                    <form th:action="@{/users/{userId}/wishlists(userId=${currentUserId})}" method="post" id="wishlistForm">
                        <input type="hidden" name="country_id" th:value="${mainPhoto.countryId}"/>
                        <label>
                            Ïó¨Ìñâ ÏãúÏûë:
                            <input type="date" name="travel_date"/>
                        </label><br/>
                        <label>
                            Ïó¨Ìñâ Ï¢ÖÎ£å:
                            <input type="date" name="end_date"/>
                        </label><br/>
                        <button type="submit">Îì±Î°ù</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="country-info">
            üìç Í¥ÄÎ†® Íµ≠Í∞Ä: <span th:text="${mainPhoto.countryName}">South Korea</span>
        </div>

        <!-- comment dto -->
        <div class="comment-box" th:data-log-id="${mainPhoto.logId}">
            <div class="comment" th:each="comment : ${comments}">
                <p th:data-comment-id="${comment.commentId}">
                    <strong th:text="${comment.userNickname}">ÏûëÏÑ±Ïûê</strong>:
                    <span class="comment-content" th:text="${comment.content}"></span>
                    <button class="edit-btn" th:if="${comment.userId == currentUserId}">ÏàòÏ†ï</button>
                    <button class="delete-btn" th:if="${comment.userId == currentUserId}">ÏÇ≠Ï†ú</button>
                    <span class="edit-form" style="display:none;">
                        <input type="text" class="edit-input" th:value="${comment.content}" />
                        <button class="save-btn">Save</button>
                        <button class="cancel-btn">Cancel</button>
                    </span>
                </p>
            </div>
        </div>
        <div class="comment-section">
            <form id="commentForm" class="comment-form">
                <textarea name="content" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                <button type="submit">ÎåìÍ∏Ä Îì±Î°ù</button>
            </form>
        </div>

    </div>
</div>

<!-- relatedPhotos dto -->
<div class="related-section">
    <div class="related-title">Ïó∞Í¥ÄÎêú ÏÇ¨ÏßÑ</div>
    <div class="related-photos">
        <div th:each="relatedPhoto : ${relatedPhotos}">
            <a th:href="@{/gallery/{id}(id=${relatedPhoto.logId})}">
                <img th:src="${relatedPhoto.picUrl}" alt="Related Photo">
            </a>
        </div>
    </div>
</div>
</body>
</html>